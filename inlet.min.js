// Generated by CoffeeScript 1.6.3
((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=[].slice;g=function(a,b,c){return c=c<0?c+1:c>1?c-1:c,c*6<1?a+(b-a)*c*6:c*2<1?b:c*3<2?a+(b-a)*(.66666-c)*6:a},f=function(a,b,c){var d,e;return e=c<=.5?c*(b+1):c+b-c*b,d=c*2-e,{r:g(d,e,a+.33333),g:g(d,e,a),b:g(d,e,a-.33333)}},k=function(a,b,c){var d,e,f,g,h,i,j;return g=Math.max(a,b,c),h=Math.min(a,b,c),d=g-h,j=g+h,e=h===g?0:a===g?(60*(b-c)/d+360)%360:b===g?60*(c-a)/d+120:60*(a-b)/d+240,f=j/2,i=f===0?0:f===1?1:f<=.5?d/j:d/(2-j),{h:e,s:i,l:f}},e=function(a,b,c,e){return e!=null?"hsla("+d(Math.round(a*180/Math.PI),360)+","+Math.round(b*100)+"%,"+Math.round(c*100)+"%,"+e+")":"hsl("+d(Math.round(a*180/Math.PI),360)+","+Math.round(b*100)+"%,"+Math.round(c*100)+"%)"},c=function(a){var b,c,d,e,f,g;return g=document.createElement("span"),document.body.appendChild(g),g.style.backgroundColor=a,f=getComputedStyle(g).backgroundColor,document.body.removeChild(g),d=/^rgb\((\d+), (\d+), (\d+)\)$/.exec(f),d||(d=/^rgba\((\d+), (\d+), (\d+), ([\d.]+)\)$/.exec(f)),e=parseInt(d[1]),c=parseInt(d[2]),b=parseInt(d[3]),d[4]?{r:e/255,g:c/255,b:b/255,a:parseFloat(d[4])}:{r:e/255,g:c/255,b:b/255}},h=function(a){var b,c;return c=document.createElement("span"),document.body.appendChild(c),c.style.backgroundColor=a,b=c.style.backgroundColor.length>0,c.remove(),b},l=function(a,b){var c,d;for(c in b)d=b[c],a.style[c]=d;return a},d=function(a,b){return a%=b,a<0&&(a+=b),a},i=function(a,b,c){return b+(c-b)*Math.min(1,Math.max(0,a))},a=function(){function a(a,b,c){var d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;this.radius=a,this.width=b,this.lightness=c,a=this.radius,b=this.width,e=this.canvas=document.createElement("canvas"),e.width=e.height=a*2,g=e.getContext("2d"),n=g.createImageData(e.width,e.height),i=n.data;for(r=s=0,u=e.height;0<=u?s<u:s>u;r=0<=u?++s:--s)for(q=t=0,v=e.width;0<=v?t<v:t>v;q=0<=v?++t:--t){k=r-a,j=q-a,h=Math.sqrt(k*k+j*j);if(h>a+1.5)continue;h-=10,p=Math.max(0,Math.min(1,h/(a-b/2-10))),m=Math.atan2(k,j)/(Math.PI*2),w=f(m,p,this.lightness),o=w.r,l=w.g,d=w.b,i[(r*e.width+q)*4+0]=o*255,i[(r*e.width+q)*4+1]=l*255,i[(r*e.width+q)*4+2]=d*255,i[(r*e.width+q)*4+3]=255}g.putImageData(n,0,0)}return a.prototype.drawHSLCircle=function(a,b){var c,d,e,f;return a.width=a.height=2*this.radius,c=a.getContext("2d"),f=this.width,e=this.radius,d=i(b,f,e),c.save(),c.fillStyle="rgba(0,0,0,0.3)",c.beginPath(),c.arc(e,e,e,0,Math.PI*2),c.fill(),c.fillStyle="black",c.beginPath(),c.arc(e,e,d,0,Math.PI*2),c.arc(e,e,d-f,0,Math.PI*2,!0),c.fill(),c.globalCompositeOperation="source-in",c.drawImage(this.canvas,0,0),c.restore()},a}(),j=function(a){return typeof a=="string"&&(a=c(a)),a.r!=null&&a.g!=null&&a.b!=null?(a=k(a.r,a.g,a.b),a.h=a.h*Math.PI/180):a.h!=null&&a.s!=null&&a.l!=null&&(a.h=a.h*Math.PI/180),a},b=function(){function s(a){this.color=j(a),this.refColor=this.color,this.el=p(),this.circleContainer=this.el.appendChild(g.call(this)),this.lSlider=this.el.appendChild(o.call(this)),this.colorPreview=this.el.appendChild(h.call(this)),b.call(this),this.setLightness(this.color.l)}var b,g,h,n,o,p,q,r;return q=80,r=25,s.prototype.setHue=function(a){var b,c,d;return this.color.h=a,d=i(this.color.s,r,q)-r/2,c=q-r/2,l(this.hueKnob,{left:Math.round(c+Math.cos(a)*d+6-1)+"px",top:Math.round(c+Math.sin(a)*d+6-1)+"px"}),this.colorPreview.style.backgroundColor=this.lKnob.style.backgroundColor=this.hueKnob.style.backgroundColor=e(this.color.h,this.color.s,this.color.l),b=e(this.color.h,this.color.s,.5),this.lSlider.style.backgroundImage="-webkit-linear-gradient(bottom, black, "+b+" 50%, white)",this.lSlider.style.backgroundImage="-moz-linear-gradient(bottom, black, "+b+" 50%, white)",this.emit("changed")},s.prototype.setSaturation=function(a){return this.color.s=a,this.circle.drawHSLCircle(this.circleCanvas,a),this.setHue(this.color.h)},s.prototype.setLightness=function(b){return this.color.l=b,this.circle=new a(q,r,b),this.lKnob.style.top=(1-b)*this.lSlider._height-11+"px",this.setSaturation(this.color.s)},s.prototype.setHSL=function(a,b,c){return this.color.h=d(a,360)*Math.PI/180,this.color.s=Math.max(0,Math.min(1,b)),c=Math.max(0,Math.min(1,c)),this.setLightness(c)},s.prototype.getHSL=function(){return{h:d(this.color.h*180/Math.PI,360),s:this.color.s,l:this.color.l}},s.prototype.setRGB=function(a,b,c){var d,e,f,g;return g=k(a,b,c),d=g.h,f=g.s,e=g.l,this.setHSL(d,f,e)},s.prototype.getRGB=function(){return f(this.color.h/(Math.PI*2),this.color.s,this.color.l)},s.prototype.getCSS=function(){return e(this.color.h,this.color.s,this.color.l)},s.prototype.setCSS=function(a){var b,d,e,f;return f=c(a),e=f.r,d=f.g,b=f.b,this.setRGB(e,d,b)},s.prototype.on=function(a,b){var c;return this._listeners==null&&(this._listeners={}),((c=this._listeners)[a]!=null?(c=this._listeners)[a]:c[a]=[]).push(b)},s.prototype.emit=function(){var a,b,c,d,e,f,g,h;b=arguments[0],a=2<=arguments.length?m.call(arguments,1):[];if(this._listeners){g=(f=this._listeners[b])!=null?f:[],h=[];for(d=0,e=g.length;d<e;d++)c=g[d],h.push(c.call.apply(c,[this].concat(m.call(a))));return h}},s.prototype.removeListener=function(a,b){var c;if(this._listeners[a])return this._listeners[a]=function(){var d,e,f,g;f=this._listeners[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],c!==b&&g.push(c);return g}.call(this)},b=function(){var a,b,c=this;return this.lKnob.onmousedown=function(a){var b,d;return document.documentElement.style.cursor="pointer",window.addEventListener("mousemove",b=function(a){var b,d;return b=c.lSlider.getBoundingClientRect(),d=a.clientY-b.top,c.setLightness(Math.max(0,Math.min(1,1-d/c.lSlider._height)))}),window.addEventListener("mouseup",d=function(a){return window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",d),window.removeEventListener("blur",d),document.documentElement.style.cursor=""}),window.addEventListener("blur",d),a.preventDefault(),a.stopPropagation()},a=this.circleContainer,b=function(b){var d,e,f,g,h,j,k;j=b.layerX,k=b.layerY,e=j-q,f=k-q,d=Math.sqrt(e*e+f*f),h=Math.atan2(f,e),g=i(c.color.s,r,q);if(!(g-r<d&&d<g))return a.style.cursor="";if(-Math.PI/8<h&&h<Math.PI/8||h>=7*Math.PI/8||h<=-7*Math.PI/8)return a.style.cursor="ew-resize";if(Math.PI/8<=h&&h<3*Math.PI/8||-7*Math.PI/8<h&&h<=-5*Math.PI/8)return a.style.cursor="nwse-resize";if(3*Math.PI/8<=h&&h<5*Math.PI/8||-5*Math.PI/8<h&&h<=-3*Math.PI/8)return a.style.cursor="ns-resize";if(5*Math.PI/8<=h&&h<7*Math.PI/8||-3*Math.PI/8<h&&h<=-Math.PI/8)return a.style.cursor="nesw-resize"},a.addEventListener("mouseover",function(c){var d,e;return b(c),a.addEventListener("mousemove",d=function(a){return b(a)}),a.addEventListener("mouseout",e=function(b){return a.style.cursor="",a.removeEventListener("mousemove",d),a.removeEventListener("mouseout",e),window.removeEventListener("blur",e)}),window.addEventListener("blur",e)}),a.addEventListener("mousedown",function(b){var d,e,f,g,h,j,k,l,m;b.preventDefault(),l=b.layerX,m=b.layerY,e=l-q,f=m-q,d=Math.sqrt(e*e+f*f),j=Math.atan2(f,e),h=i(c.color.s,r,q);if(h-r<d&&d<h)return document.documentElement.style.cursor=a.style.cursor,window.addEventListener("mousemove",g=function(a){var b,g,i;return h=c.circleCanvas.getBoundingClientRect(),b=h.left+h.width/2,g=h.top+h.height/2,e=a.clientX-b,f=a.clientY-g,d=Math.sqrt(e*e+f*f),d-=10,i=Math.max(0,Math.min(1,d/(q-r/2-10))),c.setSaturation(i)}),window.addEventListener("mouseup",k=function(a){return window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",k),window.removeEventListener("blur",k),document.documentElement.style.cursor=""}),window.addEventListener("blur",k);return}),this.hueKnob.onmousedown=function(a){var b,d;return document.documentElement.style.cursor="pointer",window.addEventListener("mousemove",b=function(a){var b,d,e;return e=c.circleCanvas.getBoundingClientRect(),b=e.left+e.width/2,d=e.top+e.height/2,c.setHue(Math.atan2(a.clientY-d,a.clientX-b))}),window.addEventListener("mouseup",d=function(a){return window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",d),window.removeEventListener("blur",d),document.documentElement.style.cursor=""}),window.addEventListener("blur",d),a.preventDefault(),a.stopPropagation()}},p=function(){var a;return a=document.createElement("div"),a.className="picker",l(a,{display:"inline-block",background:"hsl(0, 0%, 97%)",padding:"6px",borderRadius:"6px",boxShadow:"1px 1px 5px hsla(0, 0%, 39%, 0.2), hsla(0, 0%, 100%, 0.9) 0px 0px 1em 0.3em inset",border:"1px solid hsla(0, 0%, 59%, 0.2)",position:"absolute",backgroundImage:"-webkit-linear-gradient(left top, hsla(0, 0%, 0%, 0.05) 25%, transparent 25%, transparent 50%, hsla(0, 0%, 0%, 0.05) 50%, hsla(0, 0%, 0%, 0.05) 75%, transparent 75%, transparent)",backgroundSize:"40px 40px"}),l(a,{backgroundImage:"-moz-linear-gradient(left top, hsla(0, 0%, 0%, 0.05) 25%, transparent 25%, transparent 50%, hsla(0, 0%, 0%, 0.05) 50%, hsla(0, 0%, 0%, 0.05) 75%, transparent 75%, transparent)",zIndex:"1000"}),a},g=function(){var a,b;return a=document.createElement("div"),l(a,{display:"inline-block",width:q*2+"px",height:q*2+"px",borderRadius:q+"px",boxShadow:"0px 0px 7px rgba(0,0,0,0.3)"}),a.appendChild(this.circleCanvas=document.createElement("canvas")),this.hueKnob=b=n(27),a.appendChild(b),a},o=function(){var a,b;return b=document.createElement("div"),l(b,{display:"inline-block",width:"20px",height:q*2-22+"px",marginLeft:"6px",borderRadius:"10px",boxShadow:"hsla(0, 100%, 100%, 0.1) 0 1px 2px 1px inset, hsla(0, 100%, 100%, 0.2) 0 1px inset, hsla(0, 0%, 0%, 0.4) 0 -1px 1px inset, hsla(0, 0%, 0%, 0.4) 0 1px 1px",position:"relative",top:"-11px"}),b._height=q*2-22,this.lKnob=a=n(22),l(a,{left:"-1px"}),b.appendChild(a),b},h=function(){var a,b,c;return a=document.createElement("div"),b=e(this.refColor.h,this.refColor.s,this.refColor.l),c=e(this.refColor.h,this.refColor.s,this.refColor.l,0),l(a,{boxShadow:"hsla(0, 0%, 0%, 0.5) 0 1px 5px, hsla(0, 100%, 100%, 0.4) 0 1px 1px inset, hsla(0, 0%, 0%, 0.3) 0 -1px 1px inset",height:"25px",marginTop:"6px",borderRadius:"3px",backgroundImage:"-webkit-linear-gradient(-20deg, "+c+", "+c+" 69%, "+b+" 70%, "+b+")"}),l(a,{backgroundImage:"-moz-linear-gradient(-20deg, "+c+", "+c+" 69%, "+b+" 70%, "+b+")"}),a},n=function(a){var b;return b=document.createElement("div"),b.className="knob",l(b,{position:"absolute",width:a+"px",height:a+"px",backgroundColor:"red",borderRadius:Math.floor(a/2)+"px",cursor:"pointer",backgroundImage:"-webkit-gradient(radial, 50% 0%, 0, 50% 0%, 15, color-stop(0%, rgba(255, 255, 255, 0.8)), color-stop(100%, rgba(255, 255, 255, 0.2)))",boxShadow:"white 0px 1px 1px inset, rgba(0, 0, 0, 0.4) 0px -1px 1px inset, rgba(0, 0, 0, 0.4) 0px 1px 4px 0px, rgba(0, 0, 0, 0.6) 0 0 2px"}),l(b,{backgroundImage:"radial-gradient(circle at center top, rgba(255,255,255,0.8), rgba(255, 255, 255, 0.2) 15px"}),b},s.prototype.presentModal=function(a,b){var c,d=this;return l(this.el,{left:a+"px",top:b-10+"px",opacity:"0",webkitTransition:"0.15s",MozTransition:"0.15s"}),c=document.createElement("div"),c.style.position="fixed",c.style.top=c.style.left=c.style.bottom=c.style.right="0",c.style.zIndex="999",c.onclick=function(){var a;return document.body.removeChild(c),d.el.style.top=b+10+"px",d.el.style.opacity=0,a=function(){return document.body.removeChild(d.el),d.el.removeEventListener("webkitTransitionEnd",a),d.el.removeEventListener("transitionend",a)},d.el.addEventListener("webkitTransitionEnd",a),d.el.addEventListener("transitionend",a),d.emit("closed")},document.body.appendChild(c),document.body.appendChild(this.el),this.el.offsetHeight,this.el.style.opacity="1",this.el.style.top=b+"px",this},s.prototype.presentModalBeneath=function(a){var b,c,d;return b=a.getBoundingClientRect(),c=b.left+window.scrollX,d=b.bottom+window.scrollY+4,this.presentModal(c,d)},s}(),window.thistle={Picker:b,isValidCSSColor:h}})).call(this);if(typeof Color=="undefined")var Color={};(function(){Color.Picker=function(g){var h=this;typeof g=="undefined"&&(g={}),this.callback=g.callback,g.color[0]==="#"?(this.color=Color.Space(g.color.substr(1),"STRING>HEX>RGB>HSV"),this.color.A=255):g.color.substr(0,4)==="rgba"&&(this.color=Color.Space(g.color,"W3>RGBA>HSVA")),this.eyedropLayer=g.eyedropLayer,this.eyedropMouseLayer=g.eyedropMouseLayer||g.eyedropLayer,this.container=g.container||document.body,this.size=g.size||200,this.margin=g.margin||10,this.offset=this.margin/2,this.hueWidth=g.hueWidth||38,this.doAlpha=!1;var i=document.createElement("div");i.className="ColorPicker";var j=this.size+this.hueWidth*(this.doAlpha?2:1)+this.margin-6,k=this.size+this.margin*2;i.style.height=k+"px",i.style.width=j+"px",i.style.display=g.display?"block":"none",this.container.appendChild(i),this.element=i;var l=document.createElement("div");l.style.backgroundImage="url("+c.data+")",l.className="hexBox",l.title="Eyedropper",h.eyedropMouseLayer&&(f.add(l,"mousedown",f.cancel),f.add(l,"click",function(){document.body.style.cursor="crosshair";var a=function(b){document.body.style.cursor="pointer";var c=f.coords(b),d=h.eyedropLayer.getContext("2d"),e=d.getImageData(c.x,c.y,1,1),g=Color.Space(e.data,"RGBA>HSVA");h.update(g,"HSVA"),f.remove(h.eyedropMouseLayer,"mousedown",a)};f.add(h.eyedropMouseLayer,"mousedown",a)}));var m=document.createElement("div");l.appendChild(m),i.appendChild(l);var n=/[^a-f0-9]/gi,o=document.createElement("input");o.title="HEX Code",o.className="hexInput",o.size=6,o.type="text",f.add(o,"mousedown",f.stopPropagation),f.add(o,"keydown change",function(a){var b=a.keyCode,c=o.value.replace(n,"").substr(0,6),d=parseInt("0x"+c);if(a.type=="keydown")if(b==40)d=Math.max(0,d-(a.shiftKey?10:1)),o.value=Color.Space(d,"HEX>STRING");else if(b==38)d=Math.min(16777215,d+(a.shiftKey?10:1)),o.value=Color.Space(d,"HEX>STRING");else return;if(String(d)==="NaN")return;d>16777215&&(d=16777215),d<0&&(d=0);var e=a.type=="change"?"":"hex";h.update(Color.Space(d,"HEX>RGB"),"RGB"),a.keyCode==27&&this.blur()}),i.appendChild(o);var p=document.createElement("div");p.title="Close",p.className="hexClose",p.innerHTML="x",f.add(p,"mousedown",f.cancel),f.add(p,"click",function(a){h.toggle(!1)}),i.appendChild(p),i.appendChild(document.createElement("br"));var q=document.createElement("canvas"),r=q.getContext("2d");q.style.cssText="position: absolute; top: 32px; left: "+this.offset+"px;",q.width=this.size+this.hueWidth*2+this.margin+2,q.height=this.size+this.margin,i.appendChild(q);var s=function(a){var b=a.type==="mousedown"||a.type==="touchstart";b&&(f.stop(a),o.blur());var c=h.margin/2,g={x:0,y:0};if(window!==q){var j=q;while(j!==null)g.x+=j.offsetLeft,g.y+=j.offsetTop,j=j.offsetParent}var k=a.pageX-g.x-c,l=a.pageY-g.y-c,m=d(k,0,q.width),n=d(l,0,h.size);if(a.target.className==="hexInput"){i.style.cursor="text";return}return m!==k||n!==l?(i.style.cursor="move",i.title="Move",b&&e({type:"move",event:a,element:i,callback:function(a,b){i.style.left=b.x+"px",i.style.top=b.y+"px",f.prevent(a)}})):m<=h.size?(i.style.cursor="crosshair",i.title="Saturation + Value",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.x-h.offset,0,h.size),e=d(b.y-h.offset,0,h.size);h.color.S=c/h.size*100,h.color.V=100-e/h.size*100,h.drawSample(b.state,!0),f.prevent(a)}})):m>h.size+h.margin&&m<=h.size+h.hueWidth?(i.style.cursor="crosshair",i.title="Hue",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.y-h.offset,0,h.size);h.color.H=360-Math.min(1,c/h.size)*360,h.drawSample(b.state,!0),f.prevent(a)}})):m>h.size+h.hueWidth+h.margin&&m<=h.size+h.hueWidth*2?(i.style.cursor="crosshair",i.title="Alpha",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.y-h.offset,0,h.size);h.color.A=(1-Math.min(1,c/h.size))*255,h.drawSample(b.state,!0),f.prevent(a)}})):i.style.cursor="default",!1};return f.add(i,"mousemove",s),f.add(i,"mousedown",s),this.update=function(a){typeof a=="string"?h.color=Color.Space(a,"STRING>HEX>RGB>HSV"):typeof a.R!="undefined"?h.color=Color.Space(a,"RGB>HSV"):typeof a.H!="undefined"&&(h.color=a),typeof a.A=="undefined"&&(h.color.A=255),h.drawSample("update",!0)},this.drawSample=function(c,d){r.clearRect(0,0,q.width,q.height),h.drawSquare(),h.drawHue(),this.doAlpha&&h.drawAlpha();var e=Color.Space(h.color,"HSVA>RGBA"),f=Color.Space(e,"RGB>HEX>STRING");o.value=f.toUpperCase(),m.style.backgroundColor=Color.Space(e,"RGBA>W3");var g=(360-h.color.H)/362*h.size-2;r.drawImage(a,h.size+h.hueWidth+h.offset+2,Math.round(g)+h.offset-1);if(this.doAlpha){var g=(255-h.color.A)/255*h.size-2;r.drawImage(a,h.size+h.hueWidth*2+h.offset+2,Math.round(g)+h.offset-1)}var i=h.color.S/100*h.size,g=(1-h.color.V/100)*h.size;i-=b.width/2,g-=b.height/2,r.drawImage(b,Math.round(i)+h.offset,Math.round(g)+h.offset),h.callback&&c&&d&&h.callback(e,c)},this.drawSquare=function(){var a=Color.Space({H:h.color.H,S:100,V:100},"HSV>RGB>HEX>STRING"),b=Color.Space.HEX_RGB("0x"+a),c=h.offset,d=h.size;r.fillStyle="#"+a,r.fillRect(c,c,d,d);var e=r.createLinearGradient(c,c,d+c,0);e.addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),r.fillStyle=e,r.fillRect(c,c,d,d);var e=r.createLinearGradient(0,c,0,d+c);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),r.fillStyle=e,r.fillRect(c,c,d,d),r.strokeStyle="rgba(255,255,255,0.15)",r.strokeRect(c+.5,c+.5,d-1,d-1)},this.drawHue=function(){var a=h.size+h.margin+h.offset,b=r.createLinearGradient(0,0,0,h.size+h.offset);b.addColorStop(0,"rgba(255, 0, 0, 1)"),b.addColorStop(5/6,"rgba(255, 255, 0, 1)"),b.addColorStop(4/6,"rgba(0, 255, 0, 1)"),b.addColorStop(.5,"rgba(0, 255, 255, 1)"),b.addColorStop(2/6,"rgba(0, 0, 255, 1)"),b.addColorStop(1/6,"rgba(255, 0, 255, 1)"),b.addColorStop(1,"rgba(255, 0, 0, 1)"),r.fillStyle=b,r.fillRect(a,h.offset,h.hueWidth-10,h.size),r.strokeStyle="rgba(255,255,255,0.2)",r.strokeRect(a+.5,h.offset+.5,h.hueWidth-11,h.size-1)},this.drawAlpha=function(){var a=h.size+h.margin+h.offset+h.hueWidth;r.fillStyle=c,r.fillRect(a,h.offset,h.hueWidth-10,h.size);var b=Color.Space.HSV_RGB({H:h.color.H,S:h.color.S,V:h.color.V}),d=r.createLinearGradient(0,0,0,h.size);b.A=255,d.addColorStop(0,Color.Space.RGBA_W3(b)),b.A=0,d.addColorStop(1,Color.Space.RGBA_W3(b)),r.fillStyle=d,r.fillRect(a,h.offset,h.hueWidth-10,h.size),r.strokeStyle="rgba(255,255,255,0.2)",r.strokeRect(a+.5,h.offset+.5,h.hueWidth-11,h.size-1)},this.toggle=function(a){typeof a!="boolean"&&(i.style.display==="block"?a=!1:a=!0),a?(i.style.opacity=1,i.style.display="block"):(i.style.opacity=0,i.style.display="none");if(a&&g.autoclose){var b=function(){f.remove(window,"mousedown",b),h.toggle(!1)};f.add(window,"mousedown",b)}},this.destory=function(){document.body.removeChild(i);for(var a in h)delete h[a]},this.drawSample("create"),this};var a=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=16,d=c/3;a.width=c,a.height=c;var e=-c/4,f=0;for(var g=0;g<20;g++)b.beginPath(),b.fillStyle="#fff",b.moveTo(f,c/2+e),b.lineTo(f+c/4,c/4+e),b.lineTo(f+c/4,c/4*3+e),b.fill();return b.translate(-d,-c),a}(),b=function(){var a=document.createElement("canvas");a.width=10,a.height=10;var b=a.getContext("2d");b.lineWidth=1,b.beginPath();var c=a.width/2,d=a.width/2;return b.arc(c,d,4.5,0,Math.PI*2,!0),b.strokeStyle="#000",b.stroke(),b.beginPath(),b.arc(c,d,3.5,0,Math.PI*2,!0),b.strokeStyle="#FFF",b.stroke(),a}(),c=function(a,b,c){var d=document.createElement("canvas").getContext("2d");d.canvas.width=a*2,d.canvas.height=a*2,d.fillStyle=b,d.fillRect(0,0,a,a),d.fillStyle=c,d.fillRect(a,0,a,a),d.fillStyle=c,d.fillRect(0,a,a,a),d.fillStyle=b,d.fillRect(a,a,a,a);var e=d.createPattern(d.canvas,"repeat");return e.data=d.canvas.toDataURL(),e}(8,"#FFF","#eee"),d=function(a,b,c){return a<b?b:a>c?c:a},e=function(a){function b(b,c){typeof c=="undefined"&&(c="move");var d=g(b);switch(a.type){case"move":a.callback(event,{x:d.x+h-l,y:d.y+i-m,state:c});break;case"difference":a.callback(event,{x:d.x-h,y:d.y-i,state:c});break;default:a.callback(event,{x:d.x,y:d.y,state:c})}}function c(a){window.removeEventListener("mousemove",b,!1),window.removeEventListener("mouseup",c,!1),b(a,"up")}var d=a.element,e={x:0,y:0};if(window!==d){var f=d;while(f!==null)e.x+=f.offsetLeft,e.y+=f.offsetTop,f=f.offsetParent}var h=e.x,i=e.y,j=a.event,k=g(j),l=k.x,m=k.y;window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",c,!1),b(j,"down")},f={add:function(a,b,c){if(b.indexOf(" ")!==-1){b=b.split(" ");for(var d=0;d<b.length;d++)f.add(a,b[d],c)}else a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent(b,c)},remove:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent(b,c)},stop:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},prevent:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}},g=window.ActiveXObject?function(a){return{x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop}}:function(a){return{x:a.pageX,y:a.pageY}}})(),typeof Color=="undefined"&&(Color={}),typeof Color.Space=="undefined"&&(Color.Space={}),function(){var DEG_RAD=Math.PI/180,RAD_DEG=1/DEG_RAD,functions={},shortcuts={"RGB>STRING":"RGB>HEX>STRING","STRING>RGB":"STRING>HEX>RGB"},root=Color.Space=function(color,route){shortcuts[route]&&(route=shortcuts[route]);var r=route.split(">");if(typeof color=="object"&&color[0]>=0){var type=route.split(">")[0],tmp={};for(var i=0;i<type.length;i++){var str=type.substr(i,1);tmp[str]=color[i]}color=tmp}if(functions[route])return functions[route](color);var f="color";for(var pos=1,key=r[0];pos<r.length;pos++)pos>1&&(key=key.substr(key.indexOf("_")+1)),key+=(pos===0?"":"_")+r[pos],color=root[key](color),f="Color.Space."+key+"("+f+")";return functions[route]=eval("(function(color) { return "+f+" })"),color};root.RGB_W3=function(a){return"rgb("+(a.R>>0)+","+(a.G>>0)+","+(a.B>>0)+")"},root.RGBA_W3=function(a){var b=typeof a.A=="number"?a.A/255:1;return"rgba("+(a.R>>0)+","+(a.G>>0)+","+(a.B>>0)+","+b+")"},root.W3_RGB=function(a){var a=a.substr(4,a.length-5).split(",");return{R:parseInt(a[0]),G:parseInt(a[1]),B:parseInt(a[2])}},root.W3_RGBA=function(a){var a=a.substr(5,a.length-6).split(",");return{R:parseInt(a[0]),G:parseInt(a[1]),B:parseInt(a[2]),A:parseFloat(a[3])*255}},root.STRING_HEX=function(a){return parseInt("0x"+a)},root.STRING_HEX32=function(a){return a.length===6?parseInt("0xFF"+a):parseInt("0x"+a)},root.HEX_STRING=function(a,b){b||(b=6),a||(a=0);var c=a.toString(16),d=c.length;while(d<b)c="0"+c,d++;var d=c.length;while(d>b)c=c.substr(1),d--;return c},root.HEX32_STRING=function(a){return root.HEX_STRING(a,8)},root.HEX_RGB=function(a){return{R:a>>16,G:a>>8&255,B:a&255}},root.HEX32_RGBA=function(a){return{R:a>>>16&255,G:a>>>8&255,B:a&255,A:a>>>24}},root.RGBA_HEX32=function(a){return(a.A<<24|a.R<<16|a.G<<8|a.B)>>>0},root.RGB_HEX=function(a){return a.R<0&&(a.R=0),a.G<0&&(a.G=0),a.B<0&&(a.B=0),a.R>255&&(a.R=255),a.G>255&&(a.G=255),a.B>255&&(a.B=255),a.R<<16|a.G<<8|a.B},root.RGBA_HSVA=root.RGB_HSV=function(a){var b=a.R/255,c=a.G/255,d=a.B/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=f-e,h,i,j=f;if(g===0)h=0,i=0;else{i=g/f;var k=((f-b)/6+g/2)/g,l=((f-c)/6+g/2)/g,m=((f-d)/6+g/2)/g;b===f?h=m-l:c===f?h=1/3+k-m:d===f&&(h=2/3+l-k),h<0&&(h+=1),h>1&&(h-=1)}return{H:h*360,S:i*100,V:j*100,A:a.A}},root.HSVA_RGBA=root.HSV_RGB=function(a){var b=a.H/360,c=a.S/100,d=a.V/100,e,f,g;if(c===0)e=f=g=Math.round(d*255);else{b>=1&&(b=0),b=6*b,D=b-Math.floor(b),A=Math.round(255*d*(1-c)),g=Math.round(255*d*(1-c*D)),C=Math.round(255*d*(1-c*(1-D))),d=Math.round(255*d);switch(Math.floor(b)){case 0:e=d,f=C,g=A;break;case 1:e=g,f=d,g=A;break;case 2:e=A,f=d,g=C;break;case 3:e=A,f=g,g=d;break;case 4:e=C,f=A,g=d;break;case 5:e=d,f=A,g=g}}return{R:e,G:f,B:g,A:a.A}}}(),Inlet=function(){function a(a,c){function o(a){var b=String(e.value),c=d.getCursor(!0),f=A(c);if(!f)return;var g={line:c.line,ch:f.start},h={line:c.line,ch:f.end};d.replaceRange(b,g,h)}function p(a){e.value=0;var b=d.getCursor(!0),c=A(b);if(!c)return;var f=parseFloat(c.string),g=x(f);e.setAttribute("value",f),e.setAttribute("step",g.step),e.setAttribute("min",g.min),e.setAttribute("max",g.max),e.value=f}function u(){arguments.length==1?event=arguments[0]:event=arguments[1];if(event.keyCode==q||event.keyCode==t){if(n.style.visibility==="visible")return e.stepDown(1),o(),!0;event.altKey&&w()}else if(event.keyCode==s||event.keyCode==r){if(n.style.visibility==="visible")return e.stepUp(1),o(),!0;event.altKey&&w()}else n.style.visibility="hidden"}function w(a){var c=d.getCursor(!0),g=d.getTokenAt(c);cursorOffset=d.cursorCoords(!0,"page");var m=A(c),o=y(c);if(o){var p=o.string,q=cursorOffset.top-h;cursorOffset.top<j&&(q=cursorOffset.top+i);var r=cursorOffset.left-k;f=new thistle.Picker(p),f.setCSS(p),f.presentModal(r,q),f.on("changed",function(){picked=f.getCSS(),v(picked)}),n.style.visibility="hidden"}else if(m){e.value=0;var s=parseFloat(m.string),t=x(s);e.setAttribute("value",s),e.setAttribute("step",t.step),e.setAttribute("min",t.min),e.setAttribute("max",t.max),e.value=s;var u=cursorOffset.top-l,w=window.getComputedStyle(n),z=b(w.width),B=cursorOffset.left-z/2;n.style.top=u-10+"px",n.style.left=B+"px",n.style.visibility="visible"}else n.style.visibility="hidden"}function x(a){var b,c,d,e;return a===0?b=[-100,100]:b=[-a*3,a*5],b[0]<b[1]?(min=b[0],max=b[1]):(min=b[1],max=b[0]),max-min>20?c=1:c=(max-min)/200,{min:min,max:max,step:c}}function y(a){var b=d.getLine(a.line),c=/hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)/g,e=c.exec(b);while(e){var f=e[0],g=f.length,h=e.index,i=e.index+g;if(a.ch>=h&&a.ch<=i)return e=null,{start:h,end:i,string:f};e=c.exec(b)}return}function z(a){var b=d.getLine(a.line),c=/#[a-fA-F0-9]{3,6}/g,e=c.exec(b);while(e){var f=e[0],g=f.length,h=e.index,i=e.index+g;if(a.ch>=h&&a.ch<=i)return e=null,{start:h,end:i,string:f};e=c.exec(b)}return}function A(a){var b=d.getLine(a.line),c=/[-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,e=c.exec(b);while(e){var f=e[0],g=f.length,h=e.index,i=e.index+g;if(a.ch>=h&&a.ch<=i)return e=null,{start:h,end:i,string:f};e=c.exec(b)}return}var d=a,e,f;c||(c={}),c.picker||(c.picker={}),c.slider||(c.slider={});var g=c.container||document.body,h=c.picker.topOffset||220,i=c.picker.bottomOffset||16,j=c.picker.topBoundary||250,k=c.picker.leftOffset||75,l=c.slider.yOffset||15,m=d.getWrapperElement();m.addEventListener("mousedown",w),d.setOption("onKeyEvent",u);var n=document.createElement("div");n.className="inlet_slider",n.style.visibility="hidden",n.style.position="absolute",n.style.top=0,g.appendChild(n);var e=document.createElement("input");e.className="range",e.setAttribute("type","range"),e.addEventListener("change",o),e.addEventListener("mouseup",p),n.appendChild(e);var q=37,r=38,s=39,t=40,v=function(a,b,c){var e=d.getCursor(),f=y(e);if(!f)return;var g={line:e.line,ch:f.start},h={line:e.line,ch:f.end};d.replaceRange(a,g,h)};f=new thistle.Picker("#ffffff")}function b(a){var b=0;return a.length>2&&(b=parseFloat(a.slice(0,a.length-2))),b||(b=0),b}function c(a){var b=0,c=0;while(a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop))b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}}return a}();