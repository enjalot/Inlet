/* 
	----------------------------------------------------
	Color Picker : 1.0 : 2012/04/06 : http://mudcu.be
	----------------------------------------------------
	http://colrd.com/misc/labs/Color-Picker/Classic/index.html
	----------------------------------------------------
	Firefox 2+, Safari 3+, Opera 9+, Google Chrome, IE9+
	----------------------------------------------------
	picker = new Color.Picker({
		color: "#643263", // accepts rgba(), or #hex
		callback: function(rgba, state, type) {
			document.body.style.background = Color.Space(rgba, "RGBA>W3");
		}
	});
	picker.element.style.top = 220 + "px";
	picker.element.style.left = 270 + "px";
	picker.toggle(true);
	----------------------------------------------------
	Color.Space.js â€“ STRING, HEX, RGB, HSV, RGBA, HSVA, W3
*/if(typeof Color=="undefined")var Color={};(function(){Color.Picker=function(g){var h=this;typeof g=="undefined"&&(g={}),this.callback=g.callback,g.color[0]==="#"?(this.color=Color.Space(g.color.substr(1),"STRING>HEX>RGB>HSV"),this.color.A=255):g.color.substr(0,4)==="rgba"&&(this.color=Color.Space(g.color,"W3>RGBA>HSVA")),this.eyedropLayer=g.eyedropLayer,this.eyedropMouseLayer=g.eyedropMouseLayer||g.eyedropLayer,this.container=g.container||document.body,this.size=g.size||200,this.margin=g.margin||10,this.offset=this.margin/2,this.hueWidth=g.hueWidth||38,this.doAlpha=!1;var i=document.createElement("div");i.className="ColorPicker";var j=this.size+this.hueWidth*(this.doAlpha?2:1)+this.margin-6,k=this.size+this.margin*2;i.style.height=k+"px",i.style.width=j+"px",i.style.display=g.display?"block":"none",this.container.appendChild(i),this.element=i;var l=document.createElement("div");l.style.backgroundImage="url("+c.data+")",l.className="hexBox",l.title="Eyedropper",h.eyedropMouseLayer&&(f.add(l,"mousedown",f.cancel),f.add(l,"click",function(){document.body.style.cursor="crosshair";var a=function(b){document.body.style.cursor="pointer";var c=f.coords(b),d=h.eyedropLayer.getContext("2d"),e=d.getImageData(c.x,c.y,1,1),g=Color.Space(e.data,"RGBA>HSVA");h.update(g,"HSVA"),f.remove(h.eyedropMouseLayer,"mousedown",a)};f.add(h.eyedropMouseLayer,"mousedown",a)}));var m=document.createElement("div");l.appendChild(m),i.appendChild(l);var n=/[^a-f0-9]/gi,o=document.createElement("input");o.title="HEX Code",o.className="hexInput",o.size=6,o.type="text",f.add(o,"mousedown",f.stopPropagation),f.add(o,"keydown change",function(a){var b=a.keyCode,c=o.value.replace(n,"").substr(0,6),d=parseInt("0x"+c);if(a.type=="keydown")if(b==40)d=Math.max(0,d-(a.shiftKey?10:1)),o.value=Color.Space(d,"HEX>STRING");else if(b==38)d=Math.min(16777215,d+(a.shiftKey?10:1)),o.value=Color.Space(d,"HEX>STRING");else return;if(String(d)==="NaN")return;d>16777215&&(d=16777215),d<0&&(d=0);var e=a.type=="change"?"":"hex";h.update(Color.Space(d,"HEX>RGB"),"RGB"),a.keyCode==27&&this.blur()}),i.appendChild(o);var p=document.createElement("div");p.title="Close",p.className="hexClose",p.innerHTML="x",f.add(p,"mousedown",f.cancel),f.add(p,"click",function(a){h.toggle(!1)}),i.appendChild(p),i.appendChild(document.createElement("br"));var q=document.createElement("canvas"),r=q.getContext("2d");q.style.cssText="position: absolute; top: 32px; left: "+this.offset+"px;",q.width=this.size+this.hueWidth*2+this.margin+2,q.height=this.size+this.margin,i.appendChild(q);var s=function(a){var b=a.type==="mousedown"||a.type==="touchstart";b&&(f.stop(a),o.blur());var c=h.margin/2,g={x:0,y:0};if(window!==q){var j=q;while(j!==null)g.x+=j.offsetLeft,g.y+=j.offsetTop,j=j.offsetParent}var k=a.pageX-g.x-c,l=a.pageY-g.y-c,m=d(k,0,q.width),n=d(l,0,h.size);if(a.target.className==="hexInput"){i.style.cursor="text";return}return m!==k||n!==l?(i.style.cursor="move",i.title="Move",b&&e({type:"move",event:a,element:i,callback:function(a,b){i.style.left=b.x+"px",i.style.top=b.y+"px",f.prevent(a)}})):m<=h.size?(i.style.cursor="crosshair",i.title="Saturation + Value",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.x-h.offset,0,h.size),e=d(b.y-h.offset,0,h.size);h.color.S=c/h.size*100,h.color.V=100-e/h.size*100,h.drawSample(b.state,!0),f.prevent(a)}})):m>h.size+h.margin&&m<=h.size+h.hueWidth?(i.style.cursor="crosshair",i.title="Hue",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.y-h.offset,0,h.size);h.color.H=360-Math.min(1,c/h.size)*360,h.drawSample(b.state,!0),f.prevent(a)}})):m>h.size+h.hueWidth+h.margin&&m<=h.size+h.hueWidth*2?(i.style.cursor="crosshair",i.title="Alpha",b&&e({type:"difference",event:a,element:q,callback:function(a,b){var c=d(b.y-h.offset,0,h.size);h.color.A=(1-Math.min(1,c/h.size))*255,h.drawSample(b.state,!0),f.prevent(a)}})):i.style.cursor="default",!1};return f.add(i,"mousemove",s),f.add(i,"mousedown",s),this.update=function(a){typeof a=="string"?h.color=Color.Space(a,"STRING>HEX>RGB>HSV"):typeof a.R!="undefined"?h.color=Color.Space(a,"RGB>HSV"):typeof a.H!="undefined"&&(h.color=a),typeof a.A=="undefined"&&(h.color.A=255),h.drawSample("update",!0)},this.drawSample=function(c,d){r.clearRect(0,0,q.width,q.height),h.drawSquare(),h.drawHue(),this.doAlpha&&h.drawAlpha();var e=Color.Space(h.color,"HSVA>RGBA"),f=Color.Space(e,"RGB>HEX>STRING");o.value=f.toUpperCase(),m.style.backgroundColor=Color.Space(e,"RGBA>W3");var g=(360-h.color.H)/362*h.size-2;r.drawImage(a,h.size+h.hueWidth+h.offset+2,Math.round(g)+h.offset-1);if(this.doAlpha){var g=(255-h.color.A)/255*h.size-2;r.drawImage(a,h.size+h.hueWidth*2+h.offset+2,Math.round(g)+h.offset-1)}var i=h.color.S/100*h.size,g=(1-h.color.V/100)*h.size;i-=b.width/2,g-=b.height/2,r.drawImage(b,Math.round(i)+h.offset,Math.round(g)+h.offset),h.callback&&c&&d&&h.callback(e,c)},this.drawSquare=function(){var a=Color.Space({H:h.color.H,S:100,V:100},"HSV>RGB>HEX>STRING"),b=Color.Space.HEX_RGB("0x"+a),c=h.offset,d=h.size;r.fillStyle="#"+a,r.fillRect(c,c,d,d);var e=r.createLinearGradient(c,c,d+c,0);e.addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),r.fillStyle=e,r.fillRect(c,c,d,d);var e=r.createLinearGradient(0,c,0,d+c);e.addColorStop(0,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),r.fillStyle=e,r.fillRect(c,c,d,d),r.strokeStyle="rgba(255,255,255,0.15)",r.strokeRect(c+.5,c+.5,d-1,d-1)},this.drawHue=function(){var a=h.size+h.margin+h.offset,b=r.createLinearGradient(0,0,0,h.size+h.offset);b.addColorStop(0,"rgba(255, 0, 0, 1)"),b.addColorStop(5/6,"rgba(255, 255, 0, 1)"),b.addColorStop(4/6,"rgba(0, 255, 0, 1)"),b.addColorStop(.5,"rgba(0, 255, 255, 1)"),b.addColorStop(2/6,"rgba(0, 0, 255, 1)"),b.addColorStop(1/6,"rgba(255, 0, 255, 1)"),b.addColorStop(1,"rgba(255, 0, 0, 1)"),r.fillStyle=b,r.fillRect(a,h.offset,h.hueWidth-10,h.size),r.strokeStyle="rgba(255,255,255,0.2)",r.strokeRect(a+.5,h.offset+.5,h.hueWidth-11,h.size-1)},this.drawAlpha=function(){var a=h.size+h.margin+h.offset+h.hueWidth;r.fillStyle=c,r.fillRect(a,h.offset,h.hueWidth-10,h.size);var b=Color.Space.HSV_RGB({H:h.color.H,S:h.color.S,V:h.color.V}),d=r.createLinearGradient(0,0,0,h.size);b.A=255,d.addColorStop(0,Color.Space.RGBA_W3(b)),b.A=0,d.addColorStop(1,Color.Space.RGBA_W3(b)),r.fillStyle=d,r.fillRect(a,h.offset,h.hueWidth-10,h.size),r.strokeStyle="rgba(255,255,255,0.2)",r.strokeRect(a+.5,h.offset+.5,h.hueWidth-11,h.size-1)},this.toggle=function(a){typeof a!="boolean"&&(i.style.display==="block"?a=!1:a=!0),a?(i.style.opacity=1,i.style.display="block"):(i.style.opacity=0,i.style.display="none");if(a&&g.autoclose){var b=function(){f.remove(window,"mousedown",b),h.toggle(!1)};f.add(window,"mousedown",b)}},this.destory=function(){document.body.removeChild(i);for(var a in h)delete h[a]},this.drawSample("create"),this};var a=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=16,d=c/3;a.width=c,a.height=c;var e=-c/4,f=0;for(var g=0;g<20;g++)b.beginPath(),b.fillStyle="#fff",b.moveTo(f,c/2+e),b.lineTo(f+c/4,c/4+e),b.lineTo(f+c/4,c/4*3+e),b.fill();return b.translate(-d,-c),a}(),b=function(){var a=document.createElement("canvas");a.width=10,a.height=10;var b=a.getContext("2d");b.lineWidth=1,b.beginPath();var c=a.width/2,d=a.width/2;return b.arc(c,d,4.5,0,Math.PI*2,!0),b.strokeStyle="#000",b.stroke(),b.beginPath(),b.arc(c,d,3.5,0,Math.PI*2,!0),b.strokeStyle="#FFF",b.stroke(),a}(),c=function(a,b,c){var d=document.createElement("canvas").getContext("2d");d.canvas.width=a*2,d.canvas.height=a*2,d.fillStyle=b,d.fillRect(0,0,a,a),d.fillStyle=c,d.fillRect(a,0,a,a),d.fillStyle=c,d.fillRect(0,a,a,a),d.fillStyle=b,d.fillRect(a,a,a,a);var e=d.createPattern(d.canvas,"repeat");return e.data=d.canvas.toDataURL(),e}(8,"#FFF","#eee"),d=function(a,b,c){return a<b?b:a>c?c:a},e=function(a){function b(b,c){typeof c=="undefined"&&(c="move");var d=g(b);switch(a.type){case"move":a.callback(event,{x:d.x+h-l,y:d.y+i-m,state:c});break;case"difference":a.callback(event,{x:d.x-h,y:d.y-i,state:c});break;default:a.callback(event,{x:d.x,y:d.y,state:c})}}function c(a){window.removeEventListener("mousemove",b,!1),window.removeEventListener("mouseup",c,!1),b(a,"up")}var d=a.element,e={x:0,y:0};if(window!==d){var f=d;while(f!==null)e.x+=f.offsetLeft,e.y+=f.offsetTop,f=f.offsetParent}var h=e.x,i=e.y,j=a.event,k=g(j),l=k.x,m=k.y;window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",c,!1),b(j,"down")},f={add:function(a,b,c){if(b.indexOf(" ")!==-1){b=b.split(" ");for(var d=0;d<b.length;d++)f.add(a,b[d],c)}else a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent(b,c)},remove:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent(b,c)},stop:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},prevent:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}},g=window.ActiveXObject?function(a){return{x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop}}:function(a){return{x:a.pageX,y:a.pageY}}})(),typeof Color=="undefined"&&(Color={}),typeof Color.Space=="undefined"&&(Color.Space={}),function(){var DEG_RAD=Math.PI/180,RAD_DEG=1/DEG_RAD,functions={},shortcuts={"RGB>STRING":"RGB>HEX>STRING","STRING>RGB":"STRING>HEX>RGB"},root=Color.Space=function(color,route){shortcuts[route]&&(route=shortcuts[route]);var r=route.split(">");if(typeof color=="object"&&color[0]>=0){var type=route.split(">")[0],tmp={};for(var i=0;i<type.length;i++){var str=type.substr(i,1);tmp[str]=color[i]}color=tmp}if(functions[route])return functions[route](color);var f="color";for(var pos=1,key=r[0];pos<r.length;pos++)pos>1&&(key=key.substr(key.indexOf("_")+1)),key+=(pos===0?"":"_")+r[pos],color=root[key](color),f="Color.Space."+key+"("+f+")";return functions[route]=eval("(function(color) { return "+f+" })"),color};root.RGB_W3=function(a){return"rgb("+(a.R>>0)+","+(a.G>>0)+","+(a.B>>0)+")"},root.RGBA_W3=function(a){var b=typeof a.A=="number"?a.A/255:1;return"rgba("+(a.R>>0)+","+(a.G>>0)+","+(a.B>>0)+","+b+")"},root.W3_RGB=function(a){var a=a.substr(4,a.length-5).split(",");return{R:parseInt(a[0]),G:parseInt(a[1]),B:parseInt(a[2])}},root.W3_RGBA=function(a){var a=a.substr(5,a.length-6).split(",");return{R:parseInt(a[0]),G:parseInt(a[1]),B:parseInt(a[2]),A:parseFloat(a[3])*255}},root.STRING_HEX=function(a){return parseInt("0x"+a)},root.STRING_HEX32=function(a){return a.length===6?parseInt("0xFF"+a):parseInt("0x"+a)},root.HEX_STRING=function(a,b){b||(b=6),a||(a=0);var c=a.toString(16),d=c.length;while(d<b)c="0"+c,d++;var d=c.length;while(d>b)c=c.substr(1),d--;return c},root.HEX32_STRING=function(a){return root.HEX_STRING(a,8)},root.HEX_RGB=function(a){return{R:a>>16,G:a>>8&255,B:a&255}},root.HEX32_RGBA=function(a){return{R:a>>>16&255,G:a>>>8&255,B:a&255,A:a>>>24}},root.RGBA_HEX32=function(a){return(a.A<<24|a.R<<16|a.G<<8|a.B)>>>0},root.RGB_HEX=function(a){return a.R<0&&(a.R=0),a.G<0&&(a.G=0),a.B<0&&(a.B=0),a.R>255&&(a.R=255),a.G>255&&(a.G=255),a.B>255&&(a.B=255),a.R<<16|a.G<<8|a.B},root.RGBA_HSVA=root.RGB_HSV=function(a){var b=a.R/255,c=a.G/255,d=a.B/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=f-e,h,i,j=f;if(g===0)h=0,i=0;else{i=g/f;var k=((f-b)/6+g/2)/g,l=((f-c)/6+g/2)/g,m=((f-d)/6+g/2)/g;b===f?h=m-l:c===f?h=1/3+k-m:d===f&&(h=2/3+l-k),h<0&&(h+=1),h>1&&(h-=1)}return{H:h*360,S:i*100,V:j*100,A:a.A}},root.HSVA_RGBA=root.HSV_RGB=function(a){var b=a.H/360,c=a.S/100,d=a.V/100,e,f,g;if(c===0)e=f=g=Math.round(d*255);else{b>=1&&(b=0),b=6*b,D=b-Math.floor(b),A=Math.round(255*d*(1-c)),g=Math.round(255*d*(1-c*D)),C=Math.round(255*d*(1-c*(1-D))),d=Math.round(255*d);switch(Math.floor(b)){case 0:e=d,f=C,g=A;break;case 1:e=g,f=d,g=A;break;case 2:e=A,f=d,g=C;break;case 3:e=A,f=g,g=d;break;case 4:e=C,f=A,g=d;break;case 5:e=d,f=A,g=g}}return{R:e,G:f,B:g,A:a.A}}}(),Inlet=function(){function a(a,c){function j(a){var b=String(e.value),c=d.getCursor(!0),f=t(c);if(!f)return;var g={line:c.line,ch:f.start},h={line:c.line,ch:f.end};d.replaceRange(b,g,h)}function k(a){e.value=0;var b=d.getCursor(!0),c=t(b);if(!c)return;var f=parseFloat(c.string),g=r(f);e.setAttribute("value",f),e.setAttribute("step",g.step),e.setAttribute("min",g.min),e.setAttribute("max",g.max),e.value=f}function p(){arguments.length==1?event=arguments[0]:event=arguments[1];if(event.keyCode==l||event.keyCode==o){if(i.style.visibility==="visible")return e.stepDown(1),j(),!0;event.altKey?q():f.element.style.display="none"}else if(event.keyCode==n||event.keyCode==m){if(i.style.visibility==="visible")return e.stepUp(1),j(),!0;event.altKey?q():f.element.style.display="none"}else i.style.visibility="hidden",f.element.style.display="none"}function q(a){var c=d.getCursor(!0),g=d.getTokenAt(c);cursorOffset=d.cursorCoords(!0,"page");var h=t(c),j=s(c);if(j){var k=j.string;k=k.slice(1,k.length),f.update(k);var l=cursorOffset.top-210+"px",m=cursorOffset.left-75+"px",n=f.element;n.style.position="absolute",n.style.top=l,n.style.left=m,f.toggle(!0),i.style.visibility="hidden"}else if(h){f.toggle(!1),e.value=0;var o=parseFloat(h.string),p=r(o);e.setAttribute("value",o),e.setAttribute("step",p.step),e.setAttribute("min",p.min),e.setAttribute("max",p.max),e.value=o;var q=15,u=cursorOffset.top-q,v=window.getComputedStyle(i),w=b(v.width),x=cursorOffset.left-w/2;i.style.top=u-10+"px",i.style.left=x+"px",i.style.visibility="visible",f.element.style.display="none"}else i.style.visibility="hidden",f.element.style.display="none"}function r(a){var b,c,d,e;return a===0?b=[-100,100]:b=[-a*3,a*5],b[0]<b[1]?(min=b[0],max=b[1]):(min=b[1],max=b[0]),max-min>20?c=1:c=(max-min)/200,{min:min,max:max,step:c}}function s(a){var b=d.getLine(a.line),c=/#[a-fA-F0-9]{3,6}/g,e=c.exec(b);while(e){var f=e[0],g=f.length,h=e.index,i=e.index+g;if(a.ch>=h&&a.ch<=i)return e=null,{start:h,end:i,string:f};e=c.exec(b)}return}function t(a){var b=d.getLine(a.line),c=/[-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,e=c.exec(b);while(e){var f=e[0],g=f.length,h=e.index,i=e.index+g;if(a.ch>=h&&a.ch<=i)return e=null,{start:h,end:i,string:f};e=c.exec(b)}return}var d=a,e,f;c||(c={});var g=c.container||document.body,h=d.getWrapperElement();h.addEventListener("mousedown",q),d.setOption("onKeyEvent",p);var i=document.createElement("div");i.className="inlet_slider",i.style.visibility="hidden",i.style.position="absolute",i.style.top=0,g.appendChild(i);var e=document.createElement("input");e.className="range",e.setAttribute("type","range"),e.addEventListener("change",j),e.addEventListener("mouseup",k),i.appendChild(e);var l=37,m=38,n=39,o=40;f=new Color.Picker({container:g,color:"#643263",display:!1,size:150,callback:function(a,b,c){var e=Color.Space(a,"RGB>STRING"),f=d.getCursor(),g=s(f);if(!g)return;var h={line:f.line,ch:g.start},i={line:f.line,ch:g.end};d.replaceRange("#"+e.toUpperCase(),h,i)}})}function b(a){var b=0;return a.length>2&&(b=parseFloat(a.slice(0,a.length-2))),b||(b=0),b}function c(a){var b=0,c=0;while(a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop))b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}}return a}();